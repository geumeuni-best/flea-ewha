{% extends "index.html" %}

{% block head_extra %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/list.css') }}">
  <script src="{{ url_for('static', filename='js/list.js') }}" defer></script>
{% endblock head_extra %}

{% block section %}
<section class="list-section" aria-labelledby="list-title">
  <div class="product-grid-container">
    <h1 id="list-title" class="list-title">전체 상품</h1>

    {% if total > 0 %}
      {% for key, value in datas %}
      <div class="product-item" onclick="location.href='{{ url_for('view_item_detail', name=key) }}';" style="cursor:pointer;">
        <div class="product-image-wrap">
          <button class="like-btn" onclick="event.stopPropagation(); toggleLike('{{ key }}')">
            <svg class="heart-icon {% if value.is_liked %}liked{% endif %}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 21s-6.3-4.35-9.33-8.25C-1.25 6.75 2.75 2 7.5 2c2.25 0 4.5 1.5 4.5 3.75C12 3.5 14.25 2 16.5 2 21.25 2 25.25 6.75 21.33 12.75 18.3 16.65 12 21 12 21z" />
            </svg>
          </button>
          <img src="{{ url_for('static', filename='image/' ~ value.img_path) }}" alt="{{ key }}">
          
          {% if value.is_soldout %}
          <div class="overlay">
            <span class="soldout-text">품절</span>
          </div>
          {% endif %}
        </div>
        <p class="product-name">
          {% if value.status == 'new' %}
            <span class="new-badge">[new !]</span>
          {% endif %}
          {{ key }}
        </p>

        <div class="price-rating-row">
          {% if value.is_soldout %}
            <p class="product-price">품절</p>
          {% else %}
            <p class="product-price">{{ value.price }}원</p>
          {% endif %}
          <div class="product-rating">
            {% set stars = value.stars or 0 %}
            {% set rating_count = value.rating_count or 0 %}
            {% for i in range(1, 6) %}
              {% if i <= stars %}
                <span class="star filled">★</span>
              {% else %}
                <span class="star empty">★</span>
              {% endif %}
            {% endfor %}
            <span class="rating-count">({{ rating_count }})</span>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p>등록된 상품이 없습니다.</p>
    {% endif %}
  </div>

  {% if page_count > 1 %}
  <div class="pagination">
    {% if page > 0 %}
      <a href="{{ url_for('view_list', page=page-1) }}">&lt; Previous</a>
    {% else %}
      <span>&lt; Previous</span>
    {% endif %}

    <div class="page-numbers">
      {% for i in range(page_count) %}
        {% if i == page %}
          <a href="{{ url_for('view_list', page=i) }}" class="active">{{ i + 1 }}</a>
        {% else %}
          <a href="{{ url_for('view_list', page=i) }}">{{ i + 1 }}</a>
        {% endif %}
      {% endfor %}
    </div>

    {% if page < page_count - 1 %}
      <a href="{{ url_for('view_list', page=page+1) }}">Next &gt;</a>
    {% else %}
      <span>Next &gt;</span>
    {% endif %}
  </div>
  {% endif %}
</section>
{% endblock section %}
