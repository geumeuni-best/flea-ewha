<!-- 상품 세부 화면 (백엔드 연동 버전) -->

{% extends "index.html" %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/submit_item_result.css') }}">
<script src="{{ url_for('static', filename='js/submit_item_result.js') }}" defer></script>
{% endblock head_extra %}

{% block section %}
<main class="product">
  <section class="top-section">
    <section class="product-image">
      {% if "static/image/" in data.img_path %}
        <img src="{{ data.img_path }}" alt="{{ data.name }}">
      {% else %}
        <img src="{{ url_for('static', filename='image/' + data.img_path) }}" alt="{{ data.name }}">
      {% endif %}
    </section>

    <section class="product-details">
      <h1>{{ data.name }}</h1>
      <input type="hidden" id="is_logged_in" value="{{ 'true' if session.get('user') else 'false' }}">
      <input type="hidden" id="is_soldout" value="{{ 'true' if data.is_soldout else 'false' }}">

      <div class="rating-row">
        <div class="stars_all">
          {{ "★" * avg_rating }}{{ "☆" * (5 - avg_rating) }}
        </div>
        <span class="review-count">({{ review_count }})</span>
      </div>

      <p class="price">
        <span class="discount">{{ data.price }}원</span>
      </p>

      <br><br>

      <section class="product-info">
        <ul>
          <li><span class="label">배송비</span><span class="value">무료 (이벤트)</span></li>
          <li><span class="label">배송 정보</span><span class="value">마켓 자체 배송</span></li>
          <li><span class="label">배송 예정</span><span class="value">주문 후 3일 이내</span></li>
        </ul>

        <div class="divider"></div>

        <ul>
          <li><span class="label">판매자 정보</span><span class="value">{{ data.seller_id }}</span></li>
          <li><span class="label">판매자 지역</span><span class="value">{{ data.region }}</span></li>
          <li><span class="label">상품 상태</span>
            <span class="value">
              {% if data.status == "a" %}
                A급 (새상품)
              {% elif data.status == "b" %}
                B급 (미세 하자)
              {% elif data.status == "c" %}
                C급 (외관 하자)
              {% else %}
                {{ data.status }}
              {% endif %}
            </span>
          </li>
        </ul>

        <div class="divider"></div>

        <div class="purchase-info">
          <p class="total-amount">총 상품 금액</p>
          <div class="quantity-row">
            <div class="quantity-control">
              <button class="minus">-</button>
              <span class="quantity">1</span>
              <button class="plus">+</button>
            </div>
            <div class="summary">
              <span class="tsum">총 수량 1개 </span>
              {% if data.is_soldout %}
                <span class="amount">품절</span>
              {% else %}
                <span class="amount">{{ data.price }}원</span>
              {% endif %}
            </div>
          </div>
        </div>

        <br>

        <div class="button-group">
          <button class="cart">장바구니 추가</button>
          <button class="buy">바로 구매하기</button>
        </div>
      </section>
    </section>
  </section>

  <div class="divider"></div>

  <section class="desc">
    <p class="info" style="font-size:25px; width:100%;">상세 정보</p>
    <p>{{ data.description }}</p>
  </section>

  <div class="divider"></div>

  <section class="review">
    <p class="new" style="font-size:25px; width:100%;">최신 리뷰</p>

    {% if latest_reviews|length == 0 %}
      <p style="color:#888; margin-top:10px;">아직 등록된 리뷰가 없습니다.</p>

    {% else %}
      {% for r in latest_reviews %}
      <article onclick="location.href='/review/{{ data.name }}/{{ r.review_id }}'" style="cursor:pointer;">
        <div class="stars">
          {{ "★" * r.rating }}{{ "☆" * (5 - r.rating) }}
        </div>

        <h4>{{ r.reviewer_id }}</h4>
        <p>
          {{ r.content[:45] }}{% if r.content|length > 45 %}...{% endif %}
        </p>

        <span class="date">{{ r.created_at | datetimefilter }}</span>
      </article>
      {% endfor %}
    {% endif %}

    <div class="review-btn">
      <button onclick="location.href='/review?item_name={{ data.name }}'">전체 리뷰 보기</button>
    </div>
  </section>
</main>

<div id="modal" class="modal hidden">
  <div class="modal-content">
    <p id="modal-text">로그인이 필요합니다.</p>
    <div class="modal-buttons">
      <button id="modal-login">로그인</button>
      <button id="modal-confirm">닫기</button>
    </div>
  </div>
</div>
{% endblock section %}
